<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üá®üá≥ HSK 1 ‚Ä¢ Pr√°ctica de Hanzi</title>

  <style>
    :root{
      --bg1: #0b0b10;
      --bg2: #101022;
      --text: rgba(255,255,255,0.95);
      --muted: rgba(255,255,255,0.75);
      --card: rgba(255,255,255,0.06);
      --border: rgba(255,255,255,0.12);
      --border2: rgba(255,255,255,0.18);
      --panel: rgba(0,0,0,0.25);
      --dash: rgba(255,255,255,0.18);
      --accent: rgba(255,105,180,0.9);
      --chinaRed: rgba(255, 35, 35, 0.9);
      --chinaRedSoft: rgba(255, 35, 35, 0.22);
      --shadow: rgba(0,0,0,0.45);
      --outline: rgba(255,255,255,0.25);
    }

    /* Modo claro */
    [data-theme="light"]{
      --bg1: #f7f7fb;
      --bg2: #ffffff;
      --text: rgba(10,10,16,0.95);
      --muted: rgba(10,10,16,0.70);
      --card: rgba(10,10,16,0.04);
      --border: rgba(10,10,16,0.10);
      --border2: rgba(10,10,16,0.14);
      --panel: rgba(10,10,16,0.04);
      --dash: rgba(10,10,16,0.16);
      --accent: rgba(255,105,180,0.85);
      --chinaRed: rgba(220, 20, 20, 0.92);
      --chinaRedSoft: rgba(220, 20, 20, 0.16);
      --shadow: rgba(0,0,0,0.15);
      --outline: rgba(10,10,16,0.20);
    }

    body{
      margin:0;
      min-height:100vh;
      display:grid;
      place-items:center;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color: var(--text);
      padding:16px;
      position: relative;
      overflow-x: hidden;

      background:
        radial-gradient(circle at top, rgba(255,192,203,.18), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
    }

    /* Letras chinas difuminadas en el fondo */
    body::before{
      content:"Ê±âÂ≠ó ‰∏≠Êñá Â≠¶‰π† ‰Ω†Â•Ω Ë∞¢Ë∞¢ ÂÜçËßÅ Êàë ‰Ω† ‰ªñ Â•π ÊòØ ‰∏ç Êúâ Âú® ÂÆ∂ Ê∞¥ Ëå∂ Á±≥È•≠ ‰ªäÂ§© ÊòéÂ§© ‰∏≠ÂõΩ Ê±âËØ≠ Â≠¶Ê†° ËÄÅÂ∏à Â≠¶Áîü ÊúãÂèã Áà± ÂñúÊ¨¢";
      position: fixed;
      inset: -60px;
      font-size: 66px;
      line-height: 1.8;
      letter-spacing: 8px;
      opacity: 0.06;
      filter: blur(1.2px);
      transform: rotate(-10deg);
      pointer-events: none;
      white-space: pre-wrap;
      color: var(--text);
      mix-blend-mode: normal;
    }

    /* Brillo rojo suave */
    body::after{
      content:"";
      position: fixed;
      inset: 0;
      background:
        radial-gradient(circle at 20% 20%, var(--chinaRedSoft), transparent 45%),
        radial-gradient(circle at 80% 70%, rgba(255,215,0,0.10), transparent 42%);
      pointer-events: none;
    }

    .card{
      width:min(1020px, 96vw);
      background: var(--card);
      border:1px solid var(--border);
      border-radius:18px;
      padding:18px;
      box-shadow:0 20px 60px var(--shadow);
      position: relative;
      overflow: hidden;
    }

    /* Borde rojo suave estilo ‚ÄúChina‚Äù */
    .card::before{
      content:"";
      position:absolute;
      inset:-2px;
      border-radius:20px;
      padding:2px;
      background: linear-gradient(135deg, rgba(255,35,35,0.35), transparent 40%, rgba(255,215,0,0.18));
      -webkit-mask:
        linear-gradient(#000 0 0) content-box,
        linear-gradient(#000 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      pointer-events:none;
      opacity: 0.9;
    }

    .top{
      display:flex;
      gap:14px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      position: relative;
      z-index: 1;
    }

    .titleWrap{
      display:flex;
      gap:10px;
      align-items:flex-start;
    }

    /* Sello rojo (badge) */
    .seal{
      width:40px;
      height:40px;
      border-radius:12px;
      background: linear-gradient(180deg, var(--chinaRed), rgba(180,0,0,0.92));
      display:grid;
      place-items:center;
      box-shadow: 0 14px 30px rgba(255,35,35,0.18);
      border: 1px solid rgba(255,255,255,0.14);
      flex: 0 0 auto;
      position: relative;
      overflow:hidden;
    }
    .seal::after{
      content:"";
      position:absolute;
      inset:-18px;
      background: radial-gradient(circle at top left, rgba(255,255,255,0.25), transparent 45%);
      transform: rotate(15deg);
      opacity: 0.8;
    }
    .seal span{
      font-weight:900;
      letter-spacing:1px;
      position: relative;
      z-index:1;
      color:white;
    }

    .heading{
      font-size:18px;
      font-weight:900;
      letter-spacing: -0.2px;
      margin:0;
    }
    .hint{
      opacity: var(--muted);
      font-size:13px;
      line-height:1.4;
      margin-top:3px;
    }

    .controls{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }

    button, select, textarea{
      background: rgba(255,255,255,0.10);
      color: var(--text);
      border:1px solid var(--border2);
      border-radius:12px;
      padding:10px 12px;
      font-size:14px;
      backdrop-filter: blur(6px);
    }
    select{ max-width: 520px; }
    button{ cursor:pointer; }
    button.primary{
      background: var(--accent);
      color: white;
      border: none;
    }
    button.china{
      background: rgba(255,35,35,0.16);
      border: 1px solid rgba(255,35,35,0.28);
    }

    .grid{
      margin-top:14px;
      display:grid;
      grid-template-columns: 1fr;
      gap:14px;
      position: relative;
      z-index: 1;
    }
    @media(min-width:920px){
      .grid{ grid-template-columns: 420px 1fr; }
    }

    .panel{
      background: var(--panel);
      border:1px solid rgba(255,255,255,0.10);
      border-radius:14px;
      padding:14px;
    }

    .boxTitle{
      opacity: var(--muted);
      margin:0 0 8px;
      font-weight: 700;
    }

    #charBox{
      width:320px;
      height:320px;
      background: rgba(255,255,255,0.03);
      border:1px dashed var(--dash);
      border-radius:14px;
      display:grid;
      place-items:center;
      margin:auto;
    }

    #status{
      margin-top:10px;
      min-height:22px;
      opacity:0.92;
      text-align:center;
    }

    .meta{ text-align:center; margin-top:10px; }
    .meta .hanzi{ font-size:34px; font-weight:900; letter-spacing:1px; }
    .meta .pinyin{ opacity:.9; font-size:16px; margin-top:4px; }
    .meta .meaning{ opacity: var(--muted); font-size:14px; margin-top:2px; }

    .pill{
      display:inline-block;
      margin-top:10px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--border2);
      background: rgba(255,255,255,0.07);
      font-size:13px;
      opacity:.95;
    }

    textarea{
      width:100%;
      min-height:140px;
      resize:vertical;
    }

    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .spacer{ flex: 1 1 auto; }

    .themeToggle{
      display:flex; align-items:center; gap:10px;
      padding: 9px 12px;
      border-radius: 12px;
      border: 1px solid var(--border2);
      background: rgba(255,255,255,0.07);
      user-select:none;
      cursor:pointer;
    }
    .dot{
      width:10px; height:10px; border-radius:999px;
      background: rgba(255,215,0,0.85);
      box-shadow: 0 0 0 6px rgba(255,215,0,0.12);
    }
  </style>

  <!-- Librer√≠as -->
  <script src="https://cdn.jsdelivr.net/npm/hanzi-writer@3.7/dist/hanziwriter.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hanzi-writer-data@2.0/hanzi-writer-data.min.js"></script>
</head>

<body>
  <div class="card">
    <div class="top">
      <div class="titleWrap">
        <div class="seal" title="‰∏≠ÂõΩ"><span>‰∏≠</span></div>
        <div>
          <p class="heading">üá®üá≥‚ú® HSK 1 ‚Ä¢ Pr√°ctica de Hanzi</p>
          <div class="hint">Eleg√≠ una palabra, mir√° el orden de trazos y practic√° hasta completarla (se guarda el progreso).</div>
        </div>
      </div>

      <div class="controls">
        <div class="themeToggle" id="themeToggle" title="Cambiar modo">
          <div class="dot"></div>
          <div style="font-size:13px; opacity:.9;" id="themeLabel">Modo oscuro</div>
        </div>

        <label class="hint" style="margin-left:4px;">HSK 1:</label>
        <select id="wordSelect"></select>

        <button class="primary" id="showBtn">Ver trazos</button>
        <button id="quizBtn">Practicar</button>
        <button class="china" id="resetBtn">Reset</button>
      </div>
    </div>

    <div class="grid">
      <div class="panel">
        <p class="boxTitle">Canvas</p>
        <div id="charBox"></div>

        <div class="meta">
          <div class="hanzi" id="hanziText">‚Äî</div>
          <div class="pinyin" id="pinyinText">‚Äî</div>
          <div class="meaning" id="meaningText">‚Äî</div>
          <div class="pill" id="progressPill">Progreso: 0/0</div>
        </div>

        <div id="status"></div>

        <div class="hint" style="margin-top:10px;">
          En ‚ÄúPracticar‚Äù, ten√©s que hacer los trazos en orden. Si te equivoc√°s te deja reintentar el trazo.
        </div>
      </div>

      <div class="panel">
        <p class="boxTitle">Importar la lista completa HSK 1 (una vez)</p>
        <div class="hint">
          Peg√° l√≠neas con este formato (una por l√≠nea): <b>Ê±âÂ≠ó|pinyin|significado</b><br/>
          Ejemplo: <span style="opacity:.9">Â•Ω|h«éo|bueno</span>
        </div>

        <textarea id="importBox" placeholder="Peg√° ac√° la lista completa..."></textarea>

        <div class="row" style="margin-top:10px;">
          <button id="importBtn">Importar</button>
          <button class="china" id="clearProgressBtn">Borrar progreso</button>
          <div class="spacer"></div>
          <div class="hint">Tip: si import√°s, se reemplaza el men√∫.</div>
        </div>

        <div class="hint" style="margin-top:10px;">
          Extras que podemos sumar despu√©s: HSK por niveles, puntos, racha diaria, repaso de fallados, audio de pinyin.
        </div>
      </div>
    </div>
  </div>

  <script>
    // -----------------------------
    // Tema (oscuro/claro)
    // -----------------------------
    const THEME_KEY = "hanzi_theme_v1";
    const themeToggle = document.getElementById("themeToggle");
    const themeLabel = document.getElementById("themeLabel");

    function applyTheme(theme){
      document.documentElement.setAttribute("data-theme", theme);
      themeLabel.textContent = theme === "light" ? "Modo claro" : "Modo oscuro";
      localStorage.setItem(THEME_KEY, theme);
    }
    const savedTheme = localStorage.getItem(THEME_KEY) || "dark";
    applyTheme(savedTheme);

    themeToggle.addEventListener("click", () => {
      const current = document.documentElement.getAttribute("data-theme") || "dark";
      applyTheme(current === "dark" ? "light" : "dark");
    });

    // -----------------------------
    // Datos + guardado de progreso
    // -----------------------------
    const STORAGE_LIST_KEY = "hsk1_list_v1";
    const STORAGE_DONE_KEY = "hsk1_done_v1";

    // Starter (pod√©s importar la lista completa)
    const starterList = [
      { hanzi: "Â•Ω", pinyin: "h«éo", meaning: "bueno / bien" },
      { hanzi: "Êàë", pinyin: "w«í", meaning: "yo / me" },
      { hanzi: "‰Ω†", pinyin: "n«ê", meaning: "vos / t√∫" },
      { hanzi: "‰ªñ", pinyin: "tƒÅ", meaning: "√©l" },
      { hanzi: "Â•π", pinyin: "tƒÅ", meaning: "ella" },
      { hanzi: "Âêó", pinyin: "ma", meaning: "part√≠cula de pregunta" },
      { hanzi: "‰∏ç", pinyin: "b√π", meaning: "no" },
      { hanzi: "ÊòØ", pinyin: "sh√¨", meaning: "ser / estar" },
      { hanzi: "Êúâ", pinyin: "y«íu", meaning: "tener / haber" },
      { hanzi: "Âú®", pinyin: "z√†i", meaning: "en / estar en" },
      { hanzi: "ÂÆ∂", pinyin: "jiƒÅ", meaning: "casa" },
      { hanzi: "Ê∞¥", pinyin: "shu«ê", meaning: "agua" },
      { hanzi: "Ëå∂", pinyin: "ch√°", meaning: "t√©" },
      { hanzi: "Ë∞¢Ë∞¢", pinyin: "xi√®xie", meaning: "gracias" },
      { hanzi: "ÂÜçËßÅ", pinyin: "z√†iji√†n", meaning: "chau / adi√≥s" },
      { hanzi: "‰ªäÂ§©", pinyin: "jƒ´ntiƒÅn", meaning: "hoy" },
      { hanzi: "ÊòéÂ§©", pinyin: "m√≠ngtiƒÅn", meaning: "ma√±ana" },
      { hanzi: "‰∏≠ÂõΩ", pinyin: "Zh≈çnggu√≥", meaning: "China" },
      { hanzi: "Ê±âËØ≠", pinyin: "H√†ny«î", meaning: "idioma chino (mandar√≠n)" },
    ];

    function loadList() {
      const raw = localStorage.getItem(STORAGE_LIST_KEY);
      if (!raw) return starterList;
      try {
        const parsed = JSON.parse(raw);
        return Array.isArray(parsed) && parsed.length ? parsed : starterList;
      } catch {
        return starterList;
      }
    }

    function saveList(list) {
      localStorage.setItem(STORAGE_LIST_KEY, JSON.stringify(list));
    }

    function loadDoneMap() {
      const raw = localStorage.getItem(STORAGE_DONE_KEY);
      if (!raw) return {};
      try { return JSON.parse(raw) || {}; } catch { return {}; }
    }

    function saveDoneMap(map) {
      localStorage.setItem(STORAGE_DONE_KEY, JSON.stringify(map));
    }

    // -----------------------------
    // UI refs
    // -----------------------------
    const charBox = document.getElementById("charBox");
    const statusEl = document.getElementById("status");
    const wordSelect = document.getElementById("wordSelect");
    const hanziText = document.getElementById("hanziText");
    const pinyinText = document.getElementById("pinyinText");
    const meaningText = document.getElementById("meaningText");
    const progressPill = document.getElementById("progressPill");
    const importBox = document.getElementById("importBox");

    let list = loadList();
    let doneMap = loadDoneMap();
    let writer = null;
    let current = null;

    function setStatus(msg) { statusEl.textContent = msg || ""; }

    function refreshProgress() {
      const total = list.length;
      const done = Object.keys(doneMap).filter(k => doneMap[k]).length;
      progressPill.textContent = `Progreso: ${done}/${total}`;
    }

    function fillSelect() {
      wordSelect.innerHTML = "";
      list.forEach((item, idx) => {
        const opt = document.createElement("option");
        const done = doneMap[item.hanzi] ? "‚úÖ " : "";
        opt.value = String(idx);
        opt.textContent = `${done}${item.hanzi} ‚Äî ${item.pinyin} ‚Äî ${item.meaning}`;
        wordSelect.appendChild(opt);
      });
    }

    function loadItem(idx) {
      current = list[idx];
      if (!current) return;

      hanziText.textContent = current.hanzi;
      pinyinText.textContent = current.pinyin;
      meaningText.textContent = current.meaning;

      setStatus("Cargando trazos‚Ä¶");
      charBox.innerHTML = "";

      const data = HanziWriterData.getCharacterData(current.hanzi);
      if (!data) {
        setStatus("No hay datos de trazos para esto (prob√° otra palabra/caracter).");
        writer = null;
        return;
      }

      writer = HanziWriter.create(charBox, current.hanzi, {
        width: 320,
        height: 320,
        padding: 10,
        showOutline: true,
        strokeColor: getComputedStyle(document.documentElement).getPropertyValue("--text").trim() || "#ffffff",
        outlineColor: getComputedStyle(document.documentElement).getPropertyValue("--outline").trim() || "rgba(255,255,255,0.25)",
        drawingColor: "rgba(255,105,180,0.95)",
        drawingWidth: 6
      });

      setStatus("Listo. Ver trazos o practicar.");
    }

    function showSteps() {
      if (!writer) return;
      setStatus("Mostrando trazos‚Ä¶");
      writer.cancelQuiz();
      writer.animateCharacter({
        onComplete: () => setStatus("Fin. Ahora pod√©s practicar.")
      });
    }

    function startQuiz() {
      if (!writer || !current) return;
      setStatus("Modo pr√°ctica: hac√© el primer trazo.");

      writer.quiz({
        onMistake: () => setStatus("‚ùå Ese trazo no fue correcto. Reintent√° el mismo trazo."),
        onCorrectStroke: (strokeData) => {
          const next = strokeData.strokeNum + 1;
          setStatus(`‚úÖ Bien. Ahora el trazo ${next}.`);
        },
        onComplete: () => {
          setStatus("üéâ Perfecto. ¬°Completado!");
          doneMap[current.hanzi] = true;
          saveDoneMap(doneMap);
          refreshProgress();
          fillSelect();
        }
      });
    }

    function resetCanvas() {
      if (!writer) return;
      writer.cancelQuiz();
      writer.hideCharacter();
      writer.showCharacter();
      setStatus("Reseteado.");
    }

    // -----------------------------
    // Importar lista completa
    // -----------------------------
    function parseImport(text) {
      const lines = text.split(/\r?\n/).map(l => l.trim()).filter(Boolean);
      const out = [];
      for (const line of lines) {
        const parts = line.split("|").map(p => p.trim());
        if (parts.length < 3) continue;
        const [hanzi, pinyin, meaning] = parts;
        if (!hanzi || !pinyin || !meaning) continue;
        out.push({ hanzi, pinyin, meaning });
      }
      return out;
    }

    document.getElementById("importBtn").addEventListener("click", () => {
      const parsed = parseImport(importBox.value || "");
      if (!parsed.length) {
        setStatus("No pude importar: peg√° l√≠neas en formato hanzi|pinyin|significado.");
        return;
      }
      list = parsed;
      saveList(list);
      setStatus(`Importado: ${list.length} items.`);

      // limpiar progreso de items que ya no existan
      const allowed = new Set(list.map(x => x.hanzi));
      for (const k of Object.keys(doneMap)) if (!allowed.has(k)) delete doneMap[k];
      saveDoneMap(doneMap);

      fillSelect();
      refreshProgress();
      loadItem(0);
    });

    document.getElementById("clearProgressBtn").addEventListener("click", () => {
      doneMap = {};
      saveDoneMap(doneMap);
      fillSelect();
      refreshProgress();
      setStatus("Progreso borrado.");
    });

    // -----------------------------
    // Eventos
    // -----------------------------
    wordSelect.addEventListener("change", () => loadItem(Number(wordSelect.value)));
    document.getElementById("showBtn").addEventListener("click", showSteps);
    document.getElementById("quizBtn").addEventListener("click", startQuiz);
    document.getElementById("resetBtn").addEventListener("click", resetCanvas);

    // Si cambi√°s tema, recargamos el car√°cter para que el outline se vea bien en claro/oscuro
    themeToggle.addEventListener("click", () => {
      // un pel√≠n de delay para que apliquen las variables
      setTimeout(() => {
        const idx = Number(wordSelect.value || "0");
        loadItem(idx);
      }, 50);
    });

    // init
    fillSelect();
    refreshProgress();
    loadItem(0);
  </script>
</body>
</html>
